<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Atlas Edge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --background: #ffffff;
        --foreground: #0a0a0a;
        --card: #ffffff;
        --card-foreground: #0a0a0a;
        --primary: #1e3a8a;
        --primary-foreground: #ffffff;
        --secondary: #f1f5f9;
        --secondary-foreground: #0f172a;
        --muted: #f8fafc;
        --muted-foreground: #64748b;
        --accent: #e0e7ff;
        --accent-foreground: #1e3a8a;
        --destructive: #dc2626;
        --border: #e2e8f0;
        --ring: #1e3a8a;
        --radius: 0.5rem;
        --success: #10b981;
        --warning: #f59e0b;
        --info: #3b82f6;
      }

      .dark {
        --background: #0a0a0a;
        --foreground: #f8fafc;
        --card: #1a1a1a;
        --card-foreground: #f8fafc;
        --primary: #3b82f6;
        --primary-foreground: #ffffff;
        --secondary: #1e293b;
        --secondary-foreground: #f8fafc;
        --muted: #1e293b;
        --muted-foreground: #94a3b8;
        --accent: #1e3a8a;
        --accent-foreground: #ffffff;
        --destructive: #ef4444;
        --border: #1e293b;
        --ring: #3b82f6;
        --success: #22c55e;
        --warning: #eab308;
        --info: #60a5fa;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: var(--background);
        color: var(--foreground);
        min-height: 100vh;
        transition: background-color 0.3s, color 0.3s;
      }

      /* Sidebar */
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        width: 260px;
        height: 100vh;
        background: var(--card);
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        z-index: 100;
        transition: transform 0.3s ease;
      }

      .sidebar-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .sidebar-logo {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--primary), #60a5fa);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.125rem;
      }

      .sidebar-title {
        flex: 1;
      }

      .sidebar-title h1 {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--foreground);
      }

      .sidebar-title p {
        font-size: 0.75rem;
        color: var(--muted-foreground);
      }

      .sidebar-nav {
        flex: 1;
        padding: 1rem 0.75rem;
        overflow-y: auto;
      }

      .nav-section {
        margin-bottom: 1.5rem;
      }

      .nav-section-title {
        font-size: 0.6875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--muted-foreground);
        padding: 0 0.75rem;
        margin-bottom: 0.5rem;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.625rem 0.75rem;
        border-radius: var(--radius);
        color: var(--muted-foreground);
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
      }

      .nav-item:hover {
        background: var(--muted);
        color: var(--foreground);
      }

      .nav-item.active {
        background: var(--accent);
        color: var(--accent-foreground);
      }

      .nav-item svg {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
      }

      .sidebar-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--border);
      }

      .connection-status {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--muted);
        border-radius: var(--radius);
      }

      .status-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--muted-foreground);
        animation: pulse 2s ease-in-out infinite;
      }

      .status-indicator.online {
        background: var(--success);
      }

      .status-indicator.offline {
        background: var(--destructive);
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .connection-info {
        flex: 1;
      }

      .connection-label {
        font-size: 0.75rem;
        color: var(--muted-foreground);
      }

      .connection-value {
        font-size: 0.8125rem;
        font-weight: 600;
        color: var(--foreground);
      }

      /* Main Content */
      .main-content {
        margin-left: 260px;
        min-height: 100vh;
      }

      .header {
        position: sticky;
        top: 0;
        background: var(--background);
        border-bottom: 1px solid var(--border);
        padding: 1rem 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        z-index: 50;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .page-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--foreground);
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: var(--radius);
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
        border: 1px solid transparent;
        font-family: inherit;
      }

      .btn-primary {
        background: var(--primary);
        color: var(--primary-foreground);
        border-color: var(--primary);
      }

      .btn-primary:hover {
        opacity: 0.9;
      }

      .btn-secondary {
        background: var(--secondary);
        color: var(--secondary-foreground);
        border-color: var(--border);
      }

      .btn-secondary:hover {
        background: var(--muted);
      }

      .btn-ghost {
        background: transparent;
        color: var(--muted-foreground);
      }

      .btn-ghost:hover {
        background: var(--muted);
        color: var(--foreground);
      }

      .btn-destructive {
        background: var(--destructive);
        color: white;
        border-color: var(--destructive);
      }

      .btn-icon {
        padding: 0.5rem;
      }

      .btn svg {
        width: 16px;
        height: 16px;
      }

      /* Content Area */
      .content {
        padding: 1.5rem 2rem;
      }

      /* Views */
      .view {
        display: none;
      }

      .view.active {
        display: block;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .stat-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: calc(var(--radius) + 4px);
        padding: 1.25rem;
        transition: box-shadow 0.2s, transform 0.2s;
      }

      .stat-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transform: translateY(-2px);
      }

      .stat-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: 0.75rem;
      }

      .stat-icon {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .stat-icon svg {
        width: 20px;
        height: 20px;
      }

      .stat-icon.blue {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
      }

      .stat-icon.green {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
      }

      .stat-icon.amber {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
      }

      .stat-icon.purple {
        background: rgba(139, 92, 246, 0.1);
        color: #8b5cf6;
      }

      .stat-icon.red {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
      }

      .stat-badge {
        font-size: 0.6875rem;
        font-weight: 600;
        padding: 0.125rem 0.5rem;
        border-radius: 9999px;
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
      }

      .stat-badge.warning {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
      }

      .stat-badge.danger {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
      }

      .stat-label {
        font-size: 0.75rem;
        color: var(--muted-foreground);
        font-weight: 500;
        margin-bottom: 0.25rem;
      }

      .stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--foreground);
        line-height: 1.2;
      }

      .stat-subtext {
        font-size: 0.75rem;
        color: var(--muted-foreground);
        margin-top: 0.25rem;
      }

      /* System Info Grid */
      .system-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .system-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: calc(var(--radius) + 4px);
        padding: 1.25rem;
      }

      .system-card-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }

      .system-card-title {
        font-size: 0.9375rem;
        font-weight: 600;
        color: var(--foreground);
      }

      .progress-bar {
        height: 8px;
        background: var(--muted);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 0.5rem;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), #60a5fa);
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      .progress-fill.warning {
        background: linear-gradient(90deg, #f59e0b, #fbbf24);
      }

      .progress-fill.danger {
        background: linear-gradient(90deg, #ef4444, #f87171);
      }

      .system-stat {
        display: flex;
        justify-content: space-between;
        font-size: 0.8125rem;
      }

      .system-stat-label {
        color: var(--muted-foreground);
      }

      .system-stat-value {
        font-weight: 600;
        color: var(--foreground);
      }

      /* Card Section */
      .card-section {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: calc(var(--radius) + 4px);
        margin-bottom: 1.5rem;
      }

      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--border);
      }

      .card-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--foreground);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .card-actions {
        display: flex;
        gap: 0.5rem;
      }

      .card-body {
        padding: 1.25rem;
      }

      /* Table */
      .table-container {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 0.75rem 1rem;
        text-align: left;
        border-bottom: 1px solid var(--border);
      }

      th {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--muted-foreground);
        background: var(--muted);
      }

      td {
        font-size: 0.875rem;
        color: var(--foreground);
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      tbody tr:hover {
        background: var(--muted);
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.25rem 0.625rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .badge-success {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
      }

      .badge-warning {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
      }

      .badge-danger {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
      }

      .badge-info {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
      }

      .badge-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: currentColor;
      }

      .mono {
        font-family: ui-monospace, "SF Mono", monospace;
        font-size: 0.8125rem;
      }

      /* Logs */
      .logs-container {
        max-height: 500px;
        overflow-y: auto;
        background: var(--muted);
        border-radius: var(--radius);
        padding: 1rem;
      }

      .log-entry {
        display: flex;
        gap: 0.75rem;
        padding: 0.5rem 0;
        font-size: 0.8125rem;
        font-family: ui-monospace, "SF Mono", monospace;
        border-bottom: 1px solid var(--border);
      }

      .log-entry:last-child {
        border-bottom: none;
      }

      .log-timestamp {
        color: var(--muted-foreground);
        white-space: nowrap;
        flex-shrink: 0;
      }

      .log-level {
        font-weight: 600;
        width: 60px;
        flex-shrink: 0;
      }

      .log-level.INFO {
        color: var(--info);
      }

      .log-level.WARNING {
        color: var(--warning);
      }

      .log-level.ERROR {
        color: var(--destructive);
      }

      .log-level.DEBUG {
        color: var(--muted-foreground);
      }

      .log-message {
        color: var(--foreground);
        word-break: break-word;
      }

      /* Toast */
      .toast-container {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        z-index: 200;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .toast {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.875rem 1rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        animation: slideIn 0.3s ease;
        max-width: 400px;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .toast-icon {
        width: 20px;
        height: 20px;
        flex-shrink: 0;
      }

      .toast-success .toast-icon {
        color: var(--success);
      }

      .toast-error .toast-icon {
        color: var(--destructive);
      }

      .toast-warning .toast-icon {
        color: var(--warning);
      }

      .toast-info .toast-icon {
        color: var(--info);
      }

      .toast-message {
        flex: 1;
        font-size: 0.875rem;
        color: var(--foreground);
      }

      .toast-close {
        background: none;
        border: none;
        color: var(--muted-foreground);
        cursor: pointer;
        padding: 0.25rem;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
      }

      .empty-icon {
        width: 48px;
        height: 48px;
        margin: 0 auto 1rem;
        color: var(--muted-foreground);
        opacity: 0.5;
      }

      .empty-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--foreground);
        margin-bottom: 0.25rem;
      }

      .empty-description {
        font-size: 0.875rem;
        color: var(--muted-foreground);
      }

      /* Loading */
      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 3rem;
      }

      .spinner {
        width: 32px;
        height: 32px;
        border: 3px solid var(--border);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Mobile Sidebar Toggle */
      .sidebar-toggle {
        display: none;
        position: fixed;
        bottom: 1.5rem;
        left: 1.5rem;
        z-index: 101;
        width: 48px;
        height: 48px;
        background: var(--primary);
        color: var(--primary-foreground);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .sidebar-toggle svg {
        width: 24px;
        height: 24px;
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.open {
          transform: translateX(0);
        }

        .sidebar-toggle {
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .main-content {
          margin-left: 0;
        }

        .header {
          padding: 1rem;
        }

        .content {
          padding: 1rem;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 640px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }

        .header-actions {
          gap: 0.5rem;
        }

        .btn span {
          display: none;
        }

        .btn {
          padding: 0.5rem;
        }
      }

      /* Filter Tabs */
      .filter-tabs {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .filter-tab {
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius);
        font-size: 0.8125rem;
        font-weight: 500;
        cursor: pointer;
        background: none;
        border: 1px solid var(--border);
        color: var(--muted-foreground);
        transition: all 0.15s;
      }

      .filter-tab:hover {
        background: var(--muted);
        color: var(--foreground);
      }

      .filter-tab.active {
        background: var(--primary);
        color: var(--primary-foreground);
        border-color: var(--primary);
      }

      /* Search Input */
      .search-input {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
        background: var(--muted);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        width: 240px;
      }

      .search-input input {
        flex: 1;
        background: none;
        border: none;
        outline: none;
        font-size: 0.875rem;
        color: var(--foreground);
      }

      .search-input input::placeholder {
        color: var(--muted-foreground);
      }

      .search-input svg {
        width: 16px;
        height: 16px;
        color: var(--muted-foreground);
      }

      /* Select */
      .select {
        padding: 0.5rem 0.75rem;
        background: var(--muted);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        font-size: 0.875rem;
        color: var(--foreground);
        cursor: pointer;
        outline: none;
        font-family: inherit;
      }

      .select:focus {
        border-color: var(--ring);
      }

      /* Info Text */
      .info-text {
        font-size: 0.75rem;
        color: var(--muted-foreground);
        margin-top: 0.5rem;
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--muted-foreground);
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <img
            src="/static/assets/atlas.png"
            alt="Atlas Edge Logo"
            width="25"
            height="20"
          />
        </div>
        <div class="sidebar-title">
          <h1 id="device-name">Atlas Edge</h1>
          <p>Device Monitor</p>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <button class="nav-item active" data-view="dashboard">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            Dashboard
          </button>
          <button class="nav-item" data-view="system">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
              <line x1="8" y1="21" x2="16" y2="21"></line>
              <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            System Info
          </button>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Data</div>
          <button class="nav-item" data-view="records">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
              ></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
            Attendance Records
          </button>
          <button class="nav-item" data-view="logs">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="4 17 10 11 4 5"></polyline>
              <line x1="12" y1="19" x2="20" y2="19"></line>
            </svg>
            System Logs
          </button>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Settings</div>
          <button class="nav-item" data-view="config">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="3"></circle>
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
              ></path>
            </svg>
            Configuration
          </button>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="connection-status">
          <div class="status-indicator" id="connection-indicator"></div>
          <div class="connection-info">
            <div class="connection-label">Backend Status</div>
            <div class="connection-value" id="connection-status">
              Checking...
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Sidebar Toggle (Mobile) -->
    <button class="sidebar-toggle" id="sidebar-toggle">
      <svg
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>

    <!-- Main Content -->
    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <h2 class="page-title" id="page-title">Dashboard</h2>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="refreshData()">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="23 4 23 10 17 10"></polyline>
              <polyline points="1 20 1 14 7 14"></polyline>
              <path
                d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"
              ></path>
            </svg>
            <span>Refresh</span>
          </button>
          <button class="btn btn-primary" onclick="triggerSync()">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"
              ></path>
              <path d="M21 3v5h-5"></path>
            </svg>
            <span>Sync Now</span>
          </button>
          <button
            class="btn btn-ghost btn-icon"
            onclick="toggleTheme()"
            title="Toggle theme"
          >
            <svg
              id="theme-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
          </button>
        </div>
      </header>

      <div class="content">
        <!-- Dashboard View -->
        <div class="view active" id="view-dashboard">
          <div class="stats-grid" id="stats-grid">
            <!-- Stats will be populated by JS -->
          </div>

          <div class="system-grid" id="system-overview">
            <!-- System overview cards -->
          </div>

          <div class="card-section">
            <div class="card-header">
              <h3 class="card-title">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                Recent Activity
              </h3>
              <div class="card-actions">
                <button
                  class="btn btn-secondary"
                  onclick="navigateTo('records')"
                >
                  View All
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Status</th>
                      <th>Card ID</th>
                      <th>Timestamp</th>
                      <th>Location</th>
                    </tr>
                  </thead>
                  <tbody id="recent-records">
                    <tr>
                      <td colspan="4" class="loading">
                        <div class="spinner"></div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- System View -->
        <div class="view" id="view-system">
          <div class="system-grid" id="system-details">
            <!-- System details -->
          </div>

          <div class="card-section">
            <div class="card-header">
              <h3 class="card-title">Device Information</h3>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table>
                  <tbody id="device-info-table">
                    <!-- Device info -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Records View -->
        <div class="view" id="view-records">
          <div class="card-section">
            <div class="card-header">
              <h3 class="card-title">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                  ></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                Attendance Records
                <span class="badge badge-info" id="records-count">0</span>
              </h3>
              <div class="card-actions">
                <div class="filter-tabs">
                  <button class="filter-tab active" data-filter="all">
                    All
                  </button>
                  <button class="filter-tab" data-filter="synced">
                    Synced
                  </button>
                  <button class="filter-tab" data-filter="pending">
                    Pending
                  </button>
                </div>
                <div class="search-input">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                  </svg>
                  <input
                    type="text"
                    placeholder="Search card ID..."
                    id="records-search"
                  />
                </div>
                <button
                  class="btn btn-secondary"
                  onclick="exportRecords('csv')"
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  <span>Export CSV</span>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Status</th>
                      <th>Card ID</th>
                      <th>Timestamp</th>
                      <th>Location</th>
                      <th>Device</th>
                    </tr>
                  </thead>
                  <tbody id="records-table">
                    <tr>
                      <td colspan="5" class="loading">
                        <div class="spinner"></div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Logs View -->
        <div class="view" id="view-logs">
          <div class="card-section">
            <div class="card-header">
              <h3 class="card-title">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="4 17 10 11 4 5"></polyline>
                  <line x1="12" y1="19" x2="20" y2="19"></line>
                </svg>
                System Logs
              </h3>
              <div class="card-actions">
                <select
                  class="select"
                  id="log-type-select"
                  onchange="loadLogs()"
                >
                  <option value="api_sync">API Sync</option>
                  <option value="storage">Storage</option>
                  <option value="attendance">Attendance</option>
                  <option value="rfid">RFID Reader</option>
                </select>
                <select
                  class="select"
                  id="log-lines-select"
                  onchange="loadLogs()"
                >
                  <option value="50">Last 50 lines</option>
                  <option value="100" selected>Last 100 lines</option>
                  <option value="200">Last 200 lines</option>
                  <option value="500">Last 500 lines</option>
                </select>
                <button class="btn btn-secondary" onclick="exportLogs()">
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  <span>Export</span>
                </button>
                <button class="btn btn-secondary" onclick="loadLogs()">
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                  </svg>
                  <span>Refresh</span>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="logs-container" id="logs-container">
                <div class="loading">
                  <div class="spinner"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Config View -->
        <div class="view" id="view-config">
          <div class="card-section">
            <div class="card-header">
              <h3 class="card-title">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="3"></circle>
                  <path
                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                  ></path>
                </svg>
                Sync Configuration
              </h3>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table>
                  <tbody id="sync-config-table">
                    <!-- Sync config -->
                  </tbody>
                </table>
              </div>
              <p class="info-text">
                Note: Configuration changes require service restart to take
                effect.
              </p>
            </div>
          </div>

          <div class="card-section">
            <div class="card-header">
              <h3 class="card-title">Storage Management</h3>
              <div class="card-actions">
                <button class="btn btn-destructive" onclick="clearSynced()">
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path
                      d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                    ></path>
                  </svg>
                  <span>Clear Synced Records</span>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table>
                  <tbody id="storage-config-table">
                    <!-- Storage config -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card-section">
            <div class="card-header">
              <h3 class="card-title">Backend Connection</h3>
              <div class="card-actions">
                <button class="btn btn-secondary" onclick="registerDevice()">
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <line x1="20" y1="8" x2="20" y2="14"></line>
                    <line x1="23" y1="11" x2="17" y2="11"></line>
                  </svg>
                  <span>Register Device</span>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table>
                  <tbody id="backend-config-table">
                    <!-- Backend config -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
      // State
      let currentView = "dashboard";
      let currentFilter = "all";
      let searchQuery = "";
      let refreshInterval;

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        initTheme();
        initNavigation();
        initFilters();
        initSearch();
        refreshData();
        refreshInterval = setInterval(refreshData, 15000);
      });

      // Theme
      function initTheme() {
        const savedTheme = localStorage.getItem("theme");
        if (
          savedTheme === "dark" ||
          (!savedTheme &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          document.body.classList.add("dark");
          updateThemeIcon(true);
        }
      }

      function toggleTheme() {
        const isDark = document.body.classList.toggle("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
        updateThemeIcon(isDark);
      }

      function updateThemeIcon(isDark) {
        const icon = document.getElementById("theme-icon");
        if (isDark) {
          icon.innerHTML = `<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>`;
        } else {
          icon.innerHTML = `
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          `;
        }
      }

      // Navigation
      function initNavigation() {
        document.querySelectorAll(".nav-item[data-view]").forEach((item) => {
          item.addEventListener("click", () => {
            navigateTo(item.dataset.view);
          });
        });

        // Sidebar toggle
        const toggle = document.getElementById("sidebar-toggle");
        const sidebar = document.getElementById("sidebar");
        toggle.addEventListener("click", () => {
          sidebar.classList.toggle("open");
        });
      }

      function navigateTo(view) {
        currentView = view;

        // Update nav items
        document.querySelectorAll(".nav-item[data-view]").forEach((item) => {
          item.classList.toggle("active", item.dataset.view === view);
        });

        // Update views
        document.querySelectorAll(".view").forEach((v) => {
          v.classList.toggle("active", v.id === `view-${view}`);
        });

        // Update page title
        const titles = {
          dashboard: "Dashboard",
          system: "System Information",
          records: "Attendance Records",
          logs: "System Logs",
          config: "Configuration",
        };
        document.getElementById("page-title").textContent =
          titles[view] || view;

        // Close mobile sidebar
        document.getElementById("sidebar").classList.remove("open");

        // Load view-specific data
        if (view === "logs") loadLogs();
        if (view === "config") loadConfig();
      }

      // Filters
      function initFilters() {
        document.querySelectorAll(".filter-tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            document
              .querySelectorAll(".filter-tab")
              .forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");
            currentFilter = tab.dataset.filter;
            loadRecords();
          });
        });
      }

      // Search
      function initSearch() {
        const searchInput = document.getElementById("records-search");
        let debounceTimer;
        searchInput.addEventListener("input", () => {
          clearTimeout(debounceTimer);
          debounceTimer = setTimeout(() => {
            searchQuery = searchInput.value;
            loadRecords();
          }, 300);
        });
      }

      // Data Loading
      async function refreshData() {
        await Promise.all([loadStatus(), loadStats(), loadRecentRecords()]);
      }

      async function loadStatus() {
        try {
          const response = await fetch("/api/status");
          const data = await response.json();

          // Update device name
          if (data.device) {
            document.getElementById("device-name").textContent =
              data.device.name || "Device Monitor";
          }

          // Update connection status
          const indicator = document.getElementById("connection-indicator");
          const statusText = document.getElementById("connection-status");
          indicator.classList.remove("online", "offline");
          indicator.classList.add(data.backend_online ? "online" : "offline");
          statusText.textContent = data.backend_online
            ? "Connected"
            : "Disconnected";

          // Update system overview
          updateSystemOverview(data.system);
          updateDeviceInfo(data);
        } catch (error) {
          console.error("Error loading status:", error);
        }
      }

      async function loadStats() {
        try {
          const response = await fetch("/api/records/stats");
          const data = await response.json();

          const statsHtml = `
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon blue">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                  </svg>
                </div>
                <span class="stat-badge">Today</span>
              </div>
              <div class="stat-label">Today's Scans</div>
              <div class="stat-value">${data.today_count.toLocaleString()}</div>
              <div class="stat-subtext">${
                data.last_hour_count
              } in the last hour</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon purple">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                  </svg>
                </div>
              </div>
              <div class="stat-label">Total Records</div>
              <div class="stat-value">${data.total_records.toLocaleString()}</div>
              <div class="stat-subtext">${
                data.storage_usage_percent
              }% storage used</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon green">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                  </svg>
                </div>
              </div>
              <div class="stat-label">Synced</div>
              <div class="stat-value">${data.synced_records.toLocaleString()}</div>
              <div class="stat-subtext">Successfully uploaded</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon amber">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                </div>
                ${
                  data.unsynced_records > 0
                    ? '<span class="stat-badge warning">Pending</span>'
                    : ""
                }
              </div>
              <div class="stat-label">Pending Sync</div>
              <div class="stat-value">${data.unsynced_records.toLocaleString()}</div>
              <div class="stat-subtext">Awaiting upload</div>
            </div>
          `;

          document.getElementById("stats-grid").innerHTML = statsHtml;
        } catch (error) {
          console.error("Error loading stats:", error);
        }
      }

      function updateSystemOverview(system) {
        if (!system) return;

        const memPercent = system.memory_usage?.percent || 0;
        const diskPercent = system.disk_usage?.percent || 0;
        const cpuTemp = system.cpu_temp || "N/A";

        const html = `
          <div class="system-card">
            <div class="system-card-header">
              <div class="stat-icon blue">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                  <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
                  <rect x="9" y="9" width="6" height="6"></rect>
                  <line x1="9" y1="1" x2="9" y2="4"></line>
                  <line x1="15" y1="1" x2="15" y2="4"></line>
                  <line x1="9" y1="20" x2="9" y2="23"></line>
                  <line x1="15" y1="20" x2="15" y2="23"></line>
                  <line x1="20" y1="9" x2="23" y2="9"></line>
                  <line x1="20" y1="14" x2="23" y2="14"></line>
                  <line x1="1" y1="9" x2="4" y2="9"></line>
                  <line x1="1" y1="14" x2="4" y2="14"></line>
                </svg>
              </div>
              <span class="system-card-title">Memory Usage</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill ${
                memPercent > 80 ? "danger" : memPercent > 60 ? "warning" : ""
              }" style="width: ${memPercent}%"></div>
            </div>
            <div class="system-stat">
              <span class="system-stat-label">Used</span>
              <span class="system-stat-value">${
                system.memory_usage?.used_mb || 0
              } MB / ${
          system.memory_usage?.total_mb || 0
        } MB (${memPercent}%)</span>
            </div>
          </div>

          <div class="system-card">
            <div class="system-card-header">
              <div class="stat-icon purple">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                  <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                  <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                  <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                </svg>
              </div>
              <span class="system-card-title">Disk Usage</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill ${
                diskPercent > 80 ? "danger" : diskPercent > 60 ? "warning" : ""
              }" style="width: ${diskPercent}%"></div>
            </div>
            <div class="system-stat">
              <span class="system-stat-label">Used</span>
              <span class="system-stat-value">${
                system.disk_usage?.used_gb || 0
              } GB / ${
          system.disk_usage?.total_gb || 0
        } GB (${diskPercent}%)</span>
            </div>
          </div>

          <div class="system-card">
            <div class="system-card-header">
              <div class="stat-icon ${
                typeof cpuTemp === "number" && cpuTemp > 70
                  ? "red"
                  : cpuTemp > 50
                  ? "amber"
                  : "green"
              }">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                  <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"></path>
                </svg>
              </div>
              <span class="system-card-title">System Status</span>
            </div>
            <div class="system-stat">
              <span class="system-stat-label">CPU Temp</span>
              <span class="system-stat-value">${
                typeof cpuTemp === "number" ? cpuTemp + "C" : cpuTemp
              }</span>
            </div>
            <div class="system-stat" style="margin-top: 0.5rem">
              <span class="system-stat-label">Uptime</span>
              <span class="system-stat-value">${system.uptime || "N/A"}</span>
            </div>
          </div>
        `;

        document.getElementById("system-overview").innerHTML = html;
      }

      function updateDeviceInfo(data) {
        const system = data.system || {};
        const device = data.device || {};

        const html = `
          <tr><td style="width: 200px"><strong>Device Name</strong></td><td>${
            device.name || "N/A"
          }</td></tr>
          <tr><td><strong>Device ID</strong></td><td class="mono">${
            device.id || "N/A"
          }</td></tr>
          <tr><td><strong>Location</strong></td><td>${
            device.location || "N/A"
          }</td></tr>
          <tr><td><strong>Hostname</strong></td><td>${
            system.hostname || "N/A"
          }</td></tr>
          <tr><td><strong>Platform</strong></td><td>${
            system.platform || "N/A"
          } (${system.architecture || "N/A"})</td></tr>
          <tr><td><strong>Python Version</strong></td><td>${
            system.python_version || "N/A"
          }</td></tr>
          <tr><td><strong>IP Address</strong></td><td class="mono">${
            system.ip_address || "N/A"
          }</td></tr>
        `;

        document.getElementById("device-info-table").innerHTML = html;

        // Update System Info view details
        updateSystemDetails(system);
      }

      function updateSystemDetails(system) {
        if (!system) return;

        const memPercent = system.memory_usage?.percent || 0;
        const diskPercent = system.disk_usage?.percent || 0;
        const cpuTemp = system.cpu_temp;
        const cpuUsage = system.cpu_usage || 0;

        const html = `
          <div class="system-card">
            <div class="system-card-header">
              <div class="stat-icon blue">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                  <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
                  <rect x="9" y="9" width="6" height="6"></rect>
                  <line x1="9" y1="1" x2="9" y2="4"></line>
                  <line x1="15" y1="1" x2="15" y2="4"></line>
                  <line x1="9" y1="20" x2="9" y2="23"></line>
                  <line x1="15" y1="20" x2="15" y2="23"></line>
                  <line x1="20" y1="9" x2="23" y2="9"></line>
                  <line x1="20" y1="14" x2="23" y2="14"></line>
                  <line x1="1" y1="9" x2="4" y2="9"></line>
                  <line x1="1" y1="14" x2="4" y2="14"></line>
                </svg>
              </div>
              <span class="system-card-title">CPU</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill ${cpuUsage > 80 ? 'danger' : cpuUsage > 60 ? 'warning' : ''}" style="width: ${cpuUsage}%"></div>
            </div>
            <div class="system-stat">
              <span class="system-stat-label">Usage</span>
              <span class="system-stat-value">${cpuUsage}%</span>
            </div>
            <div class="system-stat" style="margin-top: 0.5rem">
              <span class="system-stat-label">Temperature</span>
              <span class="system-stat-value">${typeof cpuTemp === 'number' ? cpuTemp + 'C' : 'N/A'}</span>
            </div>
          </div>

          <div class="system-card">
            <div class="system-card-header">
              <div class="stat-icon green">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                  <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
                  <rect x="9" y="9" width="6" height="6"></rect>
                  <line x1="9" y1="1" x2="9" y2="4"></line>
                  <line x1="15" y1="1" x2="15" y2="4"></line>
                </svg>
              </div>
              <span class="system-card-title">Memory</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill ${memPercent > 80 ? 'danger' : memPercent > 60 ? 'warning' : ''}" style="width: ${memPercent}%"></div>
            </div>
            <div class="system-stat">
              <span class="system-stat-label">Used</span>
              <span class="system-stat-value">${system.memory_usage?.used_mb || 0} MB</span>
            </div>
            <div class="system-stat" style="margin-top: 0.5rem">
              <span class="system-stat-label">Total</span>
              <span class="system-stat-value">${system.memory_usage?.total_mb || 0} MB (${memPercent}%)</span>
            </div>
          </div>

          <div class="system-card">
            <div class="system-card-header">
              <div class="stat-icon purple">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                  <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                  <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                  <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                </svg>
              </div>
              <span class="system-card-title">Disk Storage</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill ${diskPercent > 80 ? 'danger' : diskPercent > 60 ? 'warning' : ''}" style="width: ${diskPercent}%"></div>
            </div>
            <div class="system-stat">
              <span class="system-stat-label">Used</span>
              <span class="system-stat-value">${system.disk_usage?.used_gb || 0} GB</span>
            </div>
            <div class="system-stat" style="margin-top: 0.5rem">
              <span class="system-stat-label">Total</span>
              <span class="system-stat-value">${system.disk_usage?.total_gb || 0} GB (${diskPercent}%)</span>
            </div>
          </div>

          <div class="system-card">
            <div class="system-card-header">
              <div class="stat-icon amber">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
              </div>
              <span class="system-card-title">System Info</span>
            </div>
            <div class="system-stat">
              <span class="system-stat-label">Uptime</span>
              <span class="system-stat-value">${system.uptime || 'N/A'}</span>
            </div>
            <div class="system-stat" style="margin-top: 0.5rem">
              <span class="system-stat-label">Hostname</span>
              <span class="system-stat-value">${system.hostname || 'N/A'}</span>
            </div>
            <div class="system-stat" style="margin-top: 0.5rem">
              <span class="system-stat-label">IP Address</span>
              <span class="system-stat-value mono">${system.ip_address || 'N/A'}</span>
            </div>
            <div class="system-stat" style="margin-top: 0.5rem">
              <span class="system-stat-label">Platform</span>
              <span class="system-stat-value">${system.platform || 'N/A'} (${system.architecture || 'N/A'})</span>
            </div>
          </div>
        `;

        document.getElementById("system-details").innerHTML = html;
      }

      async function loadRecentRecords() {
        try {
          const response = await fetch("/api/records?limit=5");
          const data = await response.json();

          const tbody = document.getElementById("recent-records");

          if (data.records.length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="4" class="empty-state">
                  <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                  </svg>
                  <div class="empty-title">No records yet</div>
                  <div class="empty-description">Scan a card to create the first record</div>
                </td>
              </tr>
            `;
            return;
          }

          tbody.innerHTML = data.records
            .map(
              (record) => `
              <tr>
                <td>
                  <span class="badge ${
                    record.synced ? "badge-success" : "badge-warning"
                  }">
                    <span class="badge-dot"></span>
                    ${record.synced ? "Synced" : "Pending"}
                  </span>
                </td>
                <td class="mono">${record.card_id}</td>
                <td>${new Date(record.timestamp).toLocaleString()}</td>
                <td>${record.location || "N/A"}</td>
              </tr>
            `
            )
            .join("");
        } catch (error) {
          console.error("Error loading recent records:", error);
        }
      }

      async function loadRecords() {
        try {
          let url = "/api/records?limit=100";
          if (currentFilter === "synced") url += "&synced=true";
          else if (currentFilter === "pending") url += "&synced=false";
          if (searchQuery) url += `&search=${encodeURIComponent(searchQuery)}`;

          const response = await fetch(url);
          const data = await response.json();

          document.getElementById("records-count").textContent = data.total;

          const tbody = document.getElementById("records-table");

          if (data.records.length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="5" class="empty-state">
                  <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                  </svg>
                  <div class="empty-title">No records found</div>
                  <div class="empty-description">Try adjusting your filters or search query</div>
                </td>
              </tr>
            `;
            return;
          }

          tbody.innerHTML = data.records
            .map(
              (record) => `
              <tr>
                <td>
                  <span class="badge ${
                    record.synced ? "badge-success" : "badge-warning"
                  }">
                    <span class="badge-dot"></span>
                    ${record.synced ? "Synced" : "Pending"}
                  </span>
                </td>
                <td class="mono">${record.card_id}</td>
                <td>${new Date(record.timestamp).toLocaleString()}</td>
                <td>${record.location || "N/A"}</td>
                <td>${record.device_name || record.device_id || "N/A"}</td>
              </tr>
            `
            )
            .join("");
        } catch (error) {
          console.error("Error loading records:", error);
        }
      }

      async function loadLogs() {
        const logType = document.getElementById("log-type-select").value;
        const lines = document.getElementById("log-lines-select").value;

        try {
          const response = await fetch(
            `/api/logs?type=${logType}&lines=${lines}`
          );
          const data = await response.json();

          const container = document.getElementById("logs-container");

          if (data.logs.length === 0) {
            container.innerHTML = `
              <div class="empty-state">
                <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="4 17 10 11 4 5"></polyline>
                  <line x1="12" y1="19" x2="20" y2="19"></line>
                </svg>
                <div class="empty-title">No logs available</div>
                <div class="empty-description">Log file is empty or doesn't exist</div>
              </div>
            `;
            return;
          }

          container.innerHTML = data.logs
            .map(
              (log) => `
              <div class="log-entry">
                <span class="log-timestamp">${log.timestamp || ""}</span>
                <span class="log-level ${log.level}">${log.level}</span>
                <span class="log-message">${log.message}</span>
              </div>
            `
            )
            .join("");

          // Scroll to bottom
          container.scrollTop = container.scrollHeight;
        } catch (error) {
          console.error("Error loading logs:", error);
          showToast("Failed to load logs", "error");
        }
      }

      async function loadConfig() {
        try {
          const [configRes, syncRes] = await Promise.all([
            fetch("/api/config"),
            fetch("/api/sync/config"),
          ]);

          const config = await configRes.json();
          const syncConfig = await syncRes.json();

          // Sync config
          document.getElementById("sync-config-table").innerHTML = `
            <tr><td style="width: 200px"><strong>Sync Mode</strong></td><td>${
              syncConfig.mode || "batch"
            }</td></tr>
            <tr><td><strong>Batch Size</strong></td><td>${
              syncConfig.batch_size || 50
            } records per chunk</td></tr>
            <tr><td><strong>Sync Interval</strong></td><td>${
              syncConfig.sync_interval || 300
            } seconds</td></tr>
            <tr><td><strong>Min Records to Sync</strong></td><td>${
              syncConfig.min_records_for_sync || 1
            }</td></tr>
            <tr><td><strong>Immediate Sync</strong></td><td>${
              syncConfig.immediate_sync ? "Enabled" : "Disabled"
            }</td></tr>
            <tr><td><strong>Last Sync</strong></td><td>${
              syncConfig.last_sync
                ? new Date(syncConfig.last_sync).toLocaleString()
                : "Never"
            }</td></tr>
          `;

          // Storage config
          document.getElementById("storage-config-table").innerHTML = `
            <tr><td style="width: 200px"><strong>Storage File</strong></td><td class="mono">${
              config.storage?.offline_log || "N/A"
            }</td></tr>
            <tr><td><strong>Max Records</strong></td><td>${
              config.storage?.max_offline_records?.toLocaleString() || "N/A"
            }</td></tr>
            <tr><td><strong>Auto Cleanup</strong></td><td>${
              config.storage?.cleanup_after_sync ? "Enabled" : "Disabled"
            }</td></tr>
          `;

          // Backend config
          document.getElementById("backend-config-table").innerHTML = `
            <tr><td style="width: 200px"><strong>API URL</strong></td><td class="mono">${
              config.server?.api_url || "N/A"
            }</td></tr>
            <tr><td><strong>API Key</strong></td><td class="mono">${
              config.server?.api_key || "N/A"
            }</td></tr>
            <tr><td><strong>Timeout</strong></td><td>${
              config.server?.timeout || 10
            } seconds</td></tr>
            <tr><td><strong>Status</strong></td><td>
              <span class="badge ${
                syncConfig.is_online ? "badge-success" : "badge-danger"
              }">
                <span class="badge-dot"></span>
                ${syncConfig.is_online ? "Connected" : "Disconnected"}
              </span>
            </td></tr>
          `;
        } catch (error) {
          console.error("Error loading config:", error);
        }
      }

      // Actions
      async function triggerSync() {
        showToast("Starting sync...", "info");

        try {
          const response = await fetch("/api/sync/trigger", { method: "POST" });
          const data = await response.json();

          if (data.success) {
            showToast(
              `Synced ${data.synced} record${data.synced !== 1 ? "s" : ""}`,
              "success"
            );
            refreshData();
          } else {
            showToast(data.message || "Sync failed", "error");
          }
        } catch (error) {
          showToast("Sync failed: " + error.message, "error");
        }
      }

      async function clearSynced() {
        if (
          !confirm(
            "Are you sure you want to clear all synced records? This cannot be undone."
          )
        ) {
          return;
        }

        try {
          const response = await fetch("/api/storage/clear", {
            method: "POST",
          });
          const data = await response.json();

          if (data.success) {
            showToast(`Cleared ${data.removed} synced records`, "success");
            refreshData();
            loadConfig();
          } else {
            showToast(data.message || "Failed to clear records", "error");
          }
        } catch (error) {
          showToast("Failed to clear records", "error");
        }
      }

      async function registerDevice() {
        try {
          const response = await fetch("/api/device/register", {
            method: "POST",
          });
          const data = await response.json();

          if (data.success) {
            showToast("Device registered successfully", "success");
          } else {
            showToast(data.message || "Registration failed", "error");
          }
        } catch (error) {
          showToast("Registration failed", "error");
        }
      }

      function exportRecords(format) {
        let url = `/api/export/records?format=${format}`;
        if (currentFilter === "synced") url += "&synced=true";
        else if (currentFilter === "pending") url += "&synced=false";

        window.location.href = url;
        showToast("Downloading records...", "info");
      }

      function exportLogs() {
        const logType = document.getElementById("log-type-select").value;
        window.location.href = `/api/export/logs?type=${logType}`;
        showToast("Downloading logs...", "info");
      }

      // Toast
      function showToast(message, type = "info") {
        const container = document.getElementById("toast-container");

        const icons = {
          success: `<svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,
          error: `<svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>`,
          warning: `<svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
          info: `<svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>`,
        };

        const toast = document.createElement("div");
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
          ${icons[type]}
          <span class="toast-message">${message}</span>
          <button class="toast-close" onclick="this.parentElement.remove()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        `;

        container.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 5000);
      }
    </script>
  </body>
</html>
